# API Scraper

Краткое руководство по развертыванию и использованию данного приложения.

## Обоснование выбора решения
Для развертывания и запуска проекта с использованием докера я проанализировал 3 варианта:
1. [Репозиторий](https://github.com/dunglas/symfony-docker) от официальной документации
2. [Скелетон](https://github.com/symfony/skeleton) с минимальным окружением Symfony
3. Кастомная сборка с нуля. Очень похож на второй вариант, различие лишь в композер файле - в скелетоне гораздо
меньше зависимостей. 
--- 
Я выбрал второй вариант - приложение по ТЗ не требует большого функционала, поэтому нет смысла подключать
лишние зависимости, которые мне не нужны

## Подготовка
В настройках PHPStorm необходимо указать пусть к composer.json, чтобы IDE находила все классы
`Settings->PHP->Composer->Path to composer.json`

## Прокси и параллельность
Чтобы все спарсить и уложится в 24 часа, с учетом ограничения в 100 запросов в минуту для IP адреса, я распараллелил
парсинг с использованием отдельных процессов + применение прокси. Прокси есть 100 штук, ограничений по трафику нет,
все прокси 100% рабочие. Чтобы запустить скрипт не с моего компа, необходимо написать мне, чтобы я выслал прокси
для конкретного IP.<br><br>

## Запуск
Процесс сбора происходит в 2 этапа. Сначала собираем все посты без поля body, далее уже после того, как все собрали - 
обновляем каждому посту поле body.
1. Запускаем `php bin/console post:get-list` - начнется процесс сбора всех постов. В среднем собирает все посты
примерно за ~1 час в 100 процессах со 100 прокси.
2. Далее необходимо заполнить body. Запускаем команду `php bin/console post:get-detail`. По дефолту стоит также 100 
процессов, но лучше загрузить в конфиг 200 проксей и запустить с 200 штуками.

### TODO-лист
1. Необходимо разобраться с правами (а именно с пользователями и группами)
2. Добавить логирование времени - сколько времени занял процесс парсинга
3. Переписать алгоритм парсинга на работу в Messenger
4. Поместить external_id после id
5. Спарсилось только 447000, а должно 450000. Разобраться, почему так
